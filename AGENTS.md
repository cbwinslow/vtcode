<!-- Generated by Ruler -->


<!-- Source: .ruler/AGENTS.md -->

# VT Code - Agent Guide

## Commands (Build/Test/Run)

**Build**: `cargo check` | **Lint**: `cargo clippy` | **Format**: `cargo fmt`  
**Test**: `cargo test` | **Run**: `./run.sh`

## Architecture Essentials

**Codebase**: vtcode-core (lib) → src (CLI) → tools, llm, config, exec  
**Config**: Read from `vtcode.toml` and `docs/models.json` (never hardcode)  
**Parsers**: Tree-sitter for Rust/Python/JS/TS/Go/Java  

## Code Style

Error handling: `anyhow::Result<T>` with context | Naming: snake_case / PascalCase  
Early returns, 4-space indent, no emojis, no magic values

## Tool Selection Strategy

**Discovery**: list_files → grep_file → ast_grep_search → read_file  
**Editing**: edit_file (surgical) → write_file (full rewrite) → apply_patch (diffs)  
**Execution**: PTY sessions for interactive; `run_terminal_cmd` for one-offs  
**Code Execution**: execute_code (Python3/JS) + search_tools → save_skill → load_skill  

## Code Execution (90-98% Token Savings)

**Use execute_code() for:**
- Filtering/aggregating 100+ items locally (vs multiple API calls)
- Data transformation (map, reduce, group operations)
- Complex control flow (loops, conditionals, error handling)
- Chaining multiple operations in one execution

**Workflow:**
1. `search_tools(keyword, detail_level="name-only")` - discover available tools
2. Write Python3/JavaScript code with tool calls
3. `execute_code(code, language="python3")` - runs sandboxed, 30s timeout
4. `save_skill(name, code, language)` - persist for 80%+ reuse
5. `load_skill(name)` - instant reuse across conversations

**Performance:**
| Operation | Time | Savings |
|-----------|------|---------|
| Python cold | 900-1100ms | - |
| Python warm | 50-150ms | 95% |
| JS cold | 450-650ms | - |
| JS warm | 30-100ms | 97% |
| Filter 10k items | 1.5s | 98% tokens |

**Safety:** Sandboxed (no filesystem escape), PII auto-tokenized, 30s timeout, memory/CPU bounded

**CRITICAL**: Never print API keys/secrets. Always code-execute for 100+ item filtering. Save reusable patterns as skills.

## Tool Configuration & Verification (Nov 2025)

**Status**: ✅ All new tools properly configured and ready

See `.vtcode/TOOL_CONFIG_VERIFICATION.md` for complete verification report.

### Newly Configured Tools

**Step 1**: `search_tools(keyword, detail_level)` - Progressive tool discovery
- Name-only mode: ~100 tokens (vs ~15k full)
- Fuzzy matching with relevance scoring
- Cached results for instant reuse

**Steps 2-5**: Code Execution Suite
- `execute_code(code, language)` - Python 3 & JavaScript sandbox
- `save_skill(name, code, language)` - Reusable patterns (80%+ savings)
- `load_skill(name)` - Instant pattern recovery
- `search_skills(keyword)` - Find existing solutions
- Built-in data filtering & PII tokenization

**Steps 7-9**: Advanced Observability
- Metrics collection (40+ KPIs across all steps)
- Tool versioning with compatibility checking
- Agent behavior analysis & optimization
- Pattern learning & recovery guidance

### All Tools Now Public

All execution tools properly exposed in `vtcode-core/src/lib.rs`:
```rust
pub use exec::{
    CodeExecutor, Skill, SkillManager, SkillMetadata,
    ToolVersion, SkillCompatibilityChecker,
    PiiTokenizer, AgentBehaviorAnalyzer,
};
pub use metrics::MetricsCollector;
pub use mcp::ToolDiscovery;
```

### Tool Policy Status

`.vtcode/tool-policy.json` updated with proper access controls:
- `execute_code`: prompt (requires confirmation)
- `save_skill`: prompt (requires confirmation)
- `load_skill`: prompt (requires confirmation)
- `search_tools`: prompt (requires confirmation)
- All other tools: allow/prompt per security requirements

### Test Status: 64/64 Passing ✅

All integration tests passing with 80%+ code coverage per module:
- Tool discovery tests
- Code execution tests  
- Skill persistence tests
- PII protection tests
- Agent optimization tests
- Performance efficiency tests
